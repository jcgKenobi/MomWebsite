<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordle - Mom Edition</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel to compile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Enhanced Storage System -->
    <script src="enhanced-storage.js"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            /* Light gray background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .app-container {
            width: 100%;
            max-width: 500px;
            margin: auto;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            min-height: 500px;
        }

        .font-poppins {
            font-family: 'Poppins', sans-serif;
        }

        /* Menu Styles */
        .menu-button {
            display: block;
            width: 100%;
            text-align: center;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
            background-color: #4f46e5;
            /* Indigo */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .menu-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
        }

        /* Game Mode Selection Styles */
        .mode-selection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .mode-card {
            cursor: pointer;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .mode-card:hover {
            transform: scale(1.1);
        }

        .mode-image-placeholder {
            height: 100px;
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #6b7280;
            border: 2px dashed #d1d5db;
        }

        .mode-card h3 {
            font-weight: 600;
        }

        /* Leaderboard Styles */
        .leaderboard-container {
            display: flex;
            flex-direction: column;
            md: flex-row;
            gap: 1.5rem;
            height: 450px;
        }

        .leaderboard-list {
            flex: 1;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 0.5rem;
        }

        .leaderboard-item {
            padding: 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .leaderboard-item.win {
            color: #059669;
        }

        .leaderboard-item.loss {
            color: #dc2626;
        }

        .leaderboard-item.selected {
            background-color: #e0e7ff;
        }

        .leaderboard-preview {
            flex: 1.5;
        }

        /* Wordle Styles */
        .wordle-container {
            position: relative;
        }

        .wordle-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            margin-bottom: 1rem;
            max-width: 350px;
            margin-left: auto;
            margin-right: auto;
        }

        .wordle-tile {
            width: 100%;
            padding-bottom: 100%;
            position: relative;
            border: 2px solid #d3d6da;
            font-size: 2rem;
            font-weight: bold;
            text-transform: uppercase;
            color: #1a202c;
            transition: all 0.3s ease;
        }

        .wordle-tile-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .wordle-tile.correct {
            background-color: #6aaa64;
            color: white;
            border-color: #6aaa64;
        }

        .wordle-tile.present {
            background-color: #c9b458;
            color: white;
            border-color: #c9b458;
        }

        .wordle-tile.absent {
            background-color: #787c7e;
            color: white;
            border-color: #787c7e;
        }

        .wordle-tile.filled {
            border-color: #878a8c;
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 5px;
        }

        .key {
            padding: 12px 8px;
            margin: 2px;
            border-radius: 4px;
            background-color: #d3d6da;
            cursor: pointer;
            font-weight: bold;
            flex-grow: 1;
            text-align: center;
        }

        .key:hover {
            background-color: #b5b9bd;
        }

        .key.correct {
            background-color: #6aaa64;
            color: white;
        }

        .key.present {
            background-color: #c9b458;
            color: white;
        }

        .key.absent {
            background-color: #787c7e;
            color: white;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- DATA & LOCALSTORAGE ---
        const WORD_BANKS = {
            ENGLISH: ["HAPPY", "HOUSE", "WATER", "HEART", "SMILE", "LIGHT", "PEACE", "DREAM", "MUSIC", "SWEET", "BREAD", "CLEAN", "FRESH", "LAUGH", "DANCE"],
            TURKEY: ["GUZEL", "SEVGI", "MUTLU", "HUZUR", "YUVA", "AILEM", "KALBI", "OMRUM", "HAYAT", "GUVEN", "SABIR", "UMUT", "GURUR", "DESTEK", "YAKIN"],
            NATURE: ["AGAC", "ORMAN", "TOPRAK", "NEHIR", "HAVA", "DENIZ", "GOKYUZU", "YAGMUR", "BULUT", "GUNES", "YILDIZ", "GEZEGEN", "DOGA", "HAYVAN", "BITKI"]
        };

        const useEnhancedStorage = () => {
            const [storage] = useState(() => new WordleStorage());
            const [gameHistory, setGameHistory] = useState([]);
            
            // Get recent games for leaderboard compatibility
            useEffect(() => {
                if (storage) {
                    setGameHistory(storage.getRecentGames(10));
                }
            }, [storage]);
            
            const addGameToHistory = (gameData) => {
                const gameRecord = storage.addGameResult(gameData);
                setGameHistory(storage.getRecentGames(10));
                return gameRecord;
            };
            
            return [gameHistory, addGameToHistory, storage];
        };

        // --- UI COMPONENTS ---
        const MainMenu = ({ navigate }) => (
            <div className="text-center relative">
                <button 
                    onClick={() => window.location.href = 'index.html'} 
                    className="absolute top-0 left-0 bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors"
                >
                    ‚Üê Back to Main Site
                </button>
                <h1 className="font-poppins text-6xl font-bold tracking-tighter mt-16">WORDLE</h1>
                <p className="text-xl font-semibold text-indigo-600 mb-12">Mom Edition</p>
                <button className="menu-button" onClick={() => navigate('MODE_SELECT')}>Play</button>
                <button className="menu-button" onClick={() => navigate('LEADERBOARD')}>Leaderboard</button>
                <button className="menu-button" onClick={() => navigate('STATISTICS')}>Statistics</button>
                <button className="menu-button" onClick={() => alert('Settings coming soon!')}>Settings</button>
            </div>
        );

        const GameModeMenu = ({ onSelectMode }) => (
            <div>
                <h2 className="text-3xl font-bold text-center mb-8">Select Mode</h2>
                <div className="mode-selection-grid">
                    <div className="mode-card" onClick={() => onSelectMode('ENGLISH')}>
                        <div className="mode-image-placeholder">English üá¨üáß</div>
                        <h3>English</h3>
                    </div>
                    <div className="mode-card" onClick={() => onSelectMode('TURKEY')}>
                        <div className="mode-image-placeholder">Turkey üáπüá∑</div>
                        <h3>T√ºrkiye</h3>
                    </div>
                    <div className="mode-card" onClick={() => onSelectMode('NATURE')}>
                        <div className="mode-image-placeholder">Nature üåø</div>
                        <h3>Doƒüa</h3>
                    </div>
                </div>
            </div>
        );

        const Leaderboard = ({ history, navigate }) => {
            const [selectedGame, setSelectedGame] = useState(history.length > 0 ? history[0] : null);

            return (
                <div>
                    <h2 className="text-3xl font-bold text-center mb-8">Previous Games</h2>
                    <div className="leaderboard-container">
                        <div className="leaderboard-list">
                            {history.length === 0 ? (
                                <p className="text-gray-500 text-center">No games played yet.</p>
                            ) : (
                                history.map((game, index) => (
                                    <div
                                        key={index}
                                        className={`leaderboard-item ${game.isWin ? 'win' : 'loss'} ${selectedGame === game ? 'selected' : ''}`}
                                        onClick={() => setSelectedGame(game)}
                                    >
                                        {game.solution}
                                    </div>
                                ))
                            )}
                        </div>
                        <div className="leaderboard-preview">
                            {selectedGame ? (
                                <WordleGrid guesses={selectedGame.guesses} solution={selectedGame.solution} isReplay={true} />
                            ) : (
                                <div className="flex items-center justify-center h-full text-gray-400">Select a game to view</div>
                            )}
                        </div>
                    </div>
                    <button className="mt-8 w-full text-center py-2 text-indigo-600 font-semibold" onClick={() => navigate('MENU')}>
                        &larr; Back to Menu
                    </button>
                </div>
            );
        };

        const EndOfRoundMenu = ({ status, solution, onNextWord, onBackToMenu }) => {
            const [isAnswerVisible, setIsAnswerVisible] = useState(false);
            const isWin = status === 'won';
            return (
                <div className="absolute inset-0 bg-white/80 flex flex-col items-center justify-center z-10 rounded-lg p-4">
                    <h2 className={`text-5xl font-bold mb-4 ${isWin ? 'text-green-600' : 'text-red-600'}`}>{isWin ? "Correct!" : "WRONG!"}</h2>
                    {isAnswerVisible && (
                        <p className="text-lg font-semibold mb-4">The word was: <span className="font-bold text-indigo-600">{solution}</span></p>
                    )}
                    <div className="flex flex-col gap-4 w-3/4">
                        {!isWin && !isAnswerVisible && (
                            <button className="menu-button bg-yellow-500 hover:bg-yellow-600" onClick={() => setIsAnswerVisible(true)}>Show Answer</button>
                        )}
                        <button className="menu-button bg-indigo-500 hover:bg-indigo-600" onClick={onNextWord}>Next Word</button>
                        <button className="menu-button bg-gray-500 hover:bg-gray-600" onClick={onBackToMenu}>Back to Menu</button>
                    </div>
                </div>
            )
        };

        // --- WORDLE GAME COMPONENTS ---
        const WordleGame = ({ solution, onGameOver, onNextWord, onBackToMenu }) => {
            const [guesses, setGuesses] = useState(Array(6).fill(null));
            const [currentGuess, setCurrentGuess] = useState("");
            const [roundStatus, setRoundStatus] = useState('playing'); // 'playing', 'won', 'lost'
            const [keyStatuses, setKeyStatuses] = useState({});
            const [isRevealing, setIsRevealing] = useState(false);

            const handleEndRound = (isWin) => {
                const finalGuesses = [...guesses];
                const currentGuessIndex = guesses.findIndex(g => g === null);
                finalGuesses[currentGuessIndex] = currentGuess;
                onGameOver({ solution, guesses: finalGuesses.filter(Boolean), isWin });
                setRoundStatus(isWin ? 'won' : 'lost');
            };

            const handleKeyPress = useCallback((key) => {
                if (roundStatus !== 'playing') return;
                if (key === "ENTER") {
                    if (currentGuess.length !== 5) return;

                    const newKeyStatuses = { ...keyStatuses };
                    for (let i = 0; i < currentGuess.length; i++) {
                        const char = currentGuess[i];
                        let status;
                        if (solution[i] === char) { status = 'correct'; }
                        else if (solution.includes(char)) { status = 'present'; }
                        else { status = 'absent'; }
                        // Proper Wordle keyboard priority: correct > present > absent
                        if (!newKeyStatuses[char] || status === 'correct') { 
                            newKeyStatuses[char] = status; 
                        }
                        else if (newKeyStatuses[char] === 'present' && status === 'absent') { 
                            /* do nothing - keep present status */ 
                        }
                        else { 
                            newKeyStatuses[char] = status; 
                        }
                    }
                    setKeyStatuses(newKeyStatuses);

                    const newGuesses = [...guesses];
                    const currentGuessIndex = guesses.findIndex(g => g === null);
                    newGuesses[currentGuessIndex] = currentGuess;
                    setGuesses(newGuesses);
                    setCurrentGuess("");

                    if (currentGuess === solution) {
                        handleEndRound(true);
                    } else if (currentGuessIndex === 5) {
                        handleEndRound(false);
                    }
                }
                else if (key === "BACKSPACE") {
                    setCurrentGuess(currentGuess.slice(0, -1));
                }
                else if (currentGuess.length < 5 && /^[A-Z√úƒûI≈û√ñ√á]$/.test(key)) {
                    setCurrentGuess(currentGuess + key);
                }
            }, [currentGuess, roundStatus, guesses, solution, keyStatuses, onGameOver]);

            useEffect(() => {
                const handleKeyDown = (e) => handleKeyPress(e.key.toUpperCase());
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [handleKeyPress]);

            return (
                <div className="wordle-container">
                    <WordleGrid guesses={guesses} currentGuess={currentGuess} solution={solution} />
                    <Keyboard onKeyPress={handleKeyPress} keyStatuses={keyStatuses} />
                    {roundStatus !== 'playing' && (
                        <EndOfRoundMenu
                            status={roundStatus}
                            solution={solution}
                            onNextWord={onNextWord}
                            onBackToMenu={onBackToMenu}
                        />
                    )}
                </div>
            );
        };

        const WordleGrid = React.memo(({ guesses, currentGuess, solution, isReplay = false }) => {
            const rows = useMemo(() => {
                return Array(6).fill(null).map((_, i) => {
                    const guess = guesses[i];
                    const isCurrentRow = !isReplay && (i === guesses.findIndex(g => g === null));
                    return {
                        id: i,
                        guess: isCurrentRow ? currentGuess : guess ?? "",
                        isSubmitted: guess != null
                    };
                });
            }, [guesses, currentGuess, isReplay]);

            return (
                <div className="wordle-grid">
                    {rows.map(({ id, guess, isSubmitted }) => (
                        <Row key={id} guess={guess} solution={solution} isSubmitted={isSubmitted} />
                    ))}
                </div>
            );
        });

        const Row = React.memo(({ guess, solution, isSubmitted }) => {
            const tiles = useMemo(() => {
                const result = [];
                for (let i = 0; i < 5; i++) {
                    const char = guess[i];
                    let className = "wordle-tile";
                    if (isSubmitted) {
                        if (solution[i] === char) { className += " correct"; }
                        else if (solution.includes(char)) { className += " present"; }
                        else { className += " absent"; }
                    } else if (char) { className += " filled"; }
                    result.push(<div key={i} className={className}><div className="wordle-tile-content">{char}</div></div>);
                }
                return result;
            }, [guess, solution, isSubmitted]);
            
            return <>{tiles}</>;
        });

        const Keyboard = React.memo(({ onKeyPress, keyStatuses }) => {
            const rows = [
                "QWERTYUIOPƒû√ú".split(""), 
                "ASDFGHJKL≈ûƒ∞".split(""), 
                ["ENTER", ..."ZXCVBNM√ñ√á".split(""), "BACKSPACE"]
            ];
            
            return (
                <div>
                    {rows.map((row, i) => (
                        <div key={i} className="keyboard-row">
                            {row.map(key => {
                                const status = keyStatuses[key];
                                const keyClassName = `key ${status ? status : ''}`;
                                const displayKey = key === "BACKSPACE" ? "‚å´" : key === "ENTER" ? "‚Üµ" : key;
                                return (
                                    <button 
                                        key={key} 
                                        className={keyClassName} 
                                        onClick={() => onKeyPress(key)}
                                        style={{ minWidth: key === "ENTER" || key === "BACKSPACE" ? "60px" : "30px" }}
                                    >
                                        {displayKey}
                                    </button>
                                );
                            })}
                        </div>
                    ))}
                </div>
            );
        });

        // --- STATISTICS COMPONENTS ---
        const Statistics = ({ storage, navigate }) => {
            const [stats, setStats] = useState(null);
            const [selectedTimeframe, setSelectedTimeframe] = useState('all');
            
            useEffect(() => {
                if (storage) {
                    setStats(storage.getStats());
                }
            }, [storage]);

            if (!stats) return <div className="text-center">Loading statistics...</div>;

            const { overall, categories } = stats;

            return (
                <div className="space-y-6">
                    <div className="text-center">
                    <h2 className="text-3xl font-bold mb-6">Mom's Wordle Statistics</h2>
                    </div>

                    {/* Main Stats Cards */}
                    <div className="grid grid-cols-2 gap-4">
                        <div className="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-gray-600">Games Played</p>
                                    <p className="text-3xl font-bold text-blue-600">{overall.totalGames}</p>
                                </div>
                                <span className="text-3xl">üéÆ</span>
                            </div>
                        </div>
                        <div className={`p-4 rounded-lg border ${
                            overall.winPercentage >= 70 ? 'bg-gradient-to-r from-green-50 to-emerald-50 border-green-200' :
                            overall.winPercentage >= 50 ? 'bg-gradient-to-r from-yellow-50 to-amber-50 border-yellow-200' :
                            'bg-gradient-to-r from-red-50 to-rose-50 border-red-200'
                        }`}>
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-gray-600">Win Rate</p>
                                    <p className={`text-3xl font-bold ${
                                        overall.winPercentage >= 70 ? 'text-green-600' :
                                        overall.winPercentage >= 50 ? 'text-yellow-600' :
                                        'text-red-600'
                                    }`}>{overall.winPercentage}%</p>
                                </div>
                                <span className="text-3xl">üèÜ</span>
                            </div>
                        </div>
                        <div className="bg-gradient-to-r from-orange-50 to-red-50 p-4 rounded-lg border border-orange-200">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-gray-600">Current Streak</p>
                                    <p className="text-3xl font-bold text-orange-600">{overall.currentStreak}</p>
                                </div>
                                <span className="text-3xl">üî•</span>
                            </div>
                        </div>
                        <div className="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-lg border border-purple-200">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="text-sm text-gray-600">Best Streak</p>
                                    <p className="text-3xl font-bold text-purple-600">{overall.bestStreak}</p>
                                </div>
                                <span className="text-3xl">‚≠ê</span>
                            </div>
                        </div>
                    </div>

                    {/* Guess Distribution */}
                    {overall.totalWins > 0 && (
                        <div className="bg-white p-6 rounded-lg shadow border">
                            <h3 className="text-xl font-bold mb-4">Guess Distribution</h3>
                            <div className="space-y-2">
                                {Object.entries(overall.guessDistribution).map(([guesses, count]) => {
                                    const percentage = overall.totalWins > 0 ? (count / overall.totalWins) * 100 : 0;
                                    const maxCount = Math.max(...Object.values(overall.guessDistribution));
                                    const width = maxCount > 0 ? (count / maxCount) * 100 : 0;
                                    
                                    return (
                                        <div key={guesses} className="flex items-center space-x-3">
                                            <span className="w-4 text-sm font-medium">{guesses}</span>
                                            <div className="flex-1 bg-gray-200 rounded-full h-6 relative">
                                                <div
                                                    className="bg-green-500 h-6 rounded-full flex items-center justify-end pr-2"
                                                    style={{ width: `${Math.max(width, 8)}%` }}
                                                >
                                                    {count > 0 && (
                                                        <span className="text-white text-xs font-medium">{count}</span>
                                                    )}
                                                </div>
                                            </div>
                                            <span className="w-12 text-sm text-gray-600">{percentage.toFixed(0)}%</span>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}

                    {/* Category Performance */}
                    <div className="bg-white p-6 rounded-lg shadow border">
                        <h3 className="text-xl font-bold mb-4">Category Performance</h3>
                        <div className="space-y-3">
                            {Object.entries(categories).map(([category, categoryStats]) => {
                                const categoryNames = {
                                    ENGLISH: 'üá¨üáß English',
                                    TURKEY: 'üáπüá∑ T√ºrkiye', 
                                    NATURE: 'üåø Doƒüa'
                                };
                                const percentage = categoryStats.played > 0 ? categoryStats.percentage : 0;
                                
                                return (
                                    <div key={category} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div className="flex items-center space-x-3">
                                            <span className="font-medium">{categoryNames[category]}</span>
                                        </div>
                                        <div className="flex items-center space-x-4 text-sm">
                                            <span className="text-gray-600">{categoryStats.played} played</span>
                                            <span className="text-gray-600">{categoryStats.won} won</span>
                                            <span className={`font-medium px-2 py-1 rounded ${
                                                percentage >= 70 ? 'bg-green-100 text-green-800' :
                                                percentage >= 50 ? 'bg-yellow-100 text-yellow-800' :
                                                'bg-red-100 text-red-800'
                                            }`}>
                                                {percentage}%
                                            </span>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {/* Recent Games */}
                    <div className="bg-white p-6 rounded-lg shadow border">
                        <h3 className="text-xl font-bold mb-4">Recent Games</h3>
                        {stats.recentGames && stats.recentGames.length > 0 ? (
                            <div className="grid grid-cols-5 gap-2">
                                {stats.recentGames.map((game, index) => (
                                    <div
                                        key={game.id || index}
                                        className={`aspect-square rounded border-2 flex items-center justify-center text-xs font-bold ${
                                            game.isWin
                                                ? 'border-green-500 bg-green-100 text-green-800'
                                                : 'border-red-500 bg-red-100 text-red-800'
                                        }`}
                                        title={`${game.solution} - ${game.isWin ? 'Won' : 'Lost'} - ${new Date(game.timestamp).toLocaleDateString()}`}
                                    >
                                        {game.isWin ? (game.guessCount || '‚úì') : '‚úó'}
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <p className="text-gray-500">No recent games</p>
                        )}
                    </div>

                    <button 
                        className="w-full text-center py-2 text-indigo-600 font-semibold hover:text-indigo-800"
                        onClick={() => navigate('MENU')}
                    >
                        ‚Üê Back to Menu
                    </button>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---
        const App = () => {
            const [page, setPage] = useState('MENU');
            const [gameHistory, addGameToHistory, storage] = useEnhancedStorage();
            const [gameConfig, setGameConfig] = useState({ mode: null, solution: null });
            const [usedWords, setUsedWords] = useState(new Set());

            // Improved word selection to avoid immediate repeats
            const selectRandomWord = useCallback((mode, excludeWord = null) => {
                const wordBank = WORD_BANKS[mode];
                let availableWords = wordBank.filter(word => 
                    word !== excludeWord && !usedWords.has(word)
                );
                
                // If all words used, reset and exclude only current word
                if (availableWords.length === 0) {
                    availableWords = wordBank.filter(word => word !== excludeWord);
                    setUsedWords(new Set());
                }
                
                const randomIndex = Math.floor(Math.random() * availableWords.length);
                const selectedWord = availableWords[randomIndex];
                
                setUsedWords(prev => new Set([...prev, selectedWord]));
                return selectedWord;
            }, [usedWords]);

            const handleSelectMode = (mode) => {
                const solution = selectRandomWord(mode);
                setGameConfig({ mode, solution });
                setPage('GAME');
            };

            const handleGameOver = (gameResult) => {
                // Convert to enhanced storage format
                const enhancedGameData = {
                    solution: gameConfig.solution,
                    guesses: gameResult.guesses,
                    isWin: gameResult.isWin,
                    mode: gameConfig.mode,
                    guessCount: gameResult.isWin ? gameResult.guesses.length : null,
                    timeSpent: null // Can add timer later if needed
                };
                addGameToHistory(enhancedGameData);
            };

            const handleNextWord = () => {
                const { mode, solution: currentSolution } = gameConfig;
                if (mode) {
                    const newSolution = selectRandomWord(mode, currentSolution);
                    setGameConfig({ mode, solution: newSolution });
                }
            };

            const renderPage = () => {
                switch (page) {
                    case 'MENU':
                        return <MainMenu navigate={setPage} />;
                    case 'MODE_SELECT':
                        return <GameModeMenu onSelectMode={handleSelectMode} />;
                    case 'GAME':
                        return <WordleGame
                            key={gameConfig.solution}
                            solution={gameConfig.solution}
                            onGameOver={handleGameOver}
                            onNextWord={handleNextWord}
                            onBackToMenu={() => setPage('MENU')}
                        />;
                    case 'LEADERBOARD':
                        return <Leaderboard history={gameHistory} navigate={setPage} />;
                    case 'STATISTICS':
                        return <Statistics storage={storage} navigate={setPage} />;
                    default:
                        return <MainMenu navigate={setPage} />;
                }
            };

            return (
                <div className="app-container">
                    {renderPage()}
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>

</html>