<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordle - Mom Edition</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Inline Styles -->
    <link rel="stylesheet" href="css/wordle-styles.css">
</head>
<body>
    <!-- React App Root -->
    <div id="root"></div>
    
    <!-- Enhanced Storage (external dependency) -->
    <script src="src/shared/utils/storage.js"></script>
    
    <!-- All Game Code in One Script -->
    <script type="text/babel">
        // ========== GAME CONSTANTS ==========
        const WORD_BANKS = {
            ENGLISH: [
                "HAPPY", "HOUSE", "WATER", "HEART", "SMILE", 
                "LIGHT", "PEACE", "DREAM", "MUSIC", "SWEET", 
                "BREAD", "CLEAN", "FRESH", "LAUGH", "DANCE"
            ],
            TURKEY: [
                "GUZEL", "SEVGI", "MUTLU", "HUZUR", "YUVA", 
                "AILEM", "KALBI", "OMRUM", "HAYAT", "GUVEN", 
                "SABIR", "UMUT", "GURUR", "DESTEK", "YAKIN"
            ],
            NATURE: [
                "AGAC", "ORMAN", "TOPRAK", "NEHIR", "HAVA", 
                "DENIZ", "GOKYUZU", "YAGMUR", "BULUT", "GUNES", 
                "YILDIZ", "GEZEGEN", "DOGA", "HAYVAN", "BITKI"
            ]
        };

        const GAME_CONFIG = {
            MAX_GUESSES: 6,
            WORD_LENGTH: 5,
            KEYBOARD_LAYOUTS: {
                TURKISH: [
                    "QWERTYUIOPĞÜ".split(""),
                    "ASDFGHJKLŞİ".split(""),
                    ["ENTER", ..."ZXCVBNMÖÇ".split(""), "BACKSPACE"]
                ]
            }
        };

        const CATEGORY_NAMES = {
            ENGLISH: '🇬🇧 English',
            TURKEY: '🇹🇷 Türkiye', 
            NATURE: '🌿 Doğa'
        };

        const SPECIAL_KEYS = {
            ENTER: "↵",
            BACKSPACE: "⌫"
        };

        // ========== GAME LOGIC ==========
        class WordleGameLogic {
            constructor() {
                this.usedWords = new Set();
            }

            selectRandomWord(mode, excludeWord = null) {
                const wordBank = WORD_BANKS[mode];
                if (!wordBank) {
                    throw new Error(`Invalid game mode: ${mode}`);
                }

                let availableWords = wordBank.filter(word => 
                    word !== excludeWord && !this.usedWords.has(word)
                );

                if (availableWords.length === 0) {
                    availableWords = wordBank.filter(word => word !== excludeWord);
                    this.usedWords.clear();
                }

                const randomIndex = Math.floor(Math.random() * availableWords.length);
                const selectedWord = availableWords[randomIndex];
                
                this.usedWords.add(selectedWord);
                return selectedWord;
            }

            evaluateGuess(guess, solution) {
                const result = [];
                const solutionArray = solution.split('');
                const guessArray = guess.split('');
                const solutionCopy = [...solutionArray];
                
                for (let i = 0; i < guessArray.length; i++) {
                    if (guessArray[i] === solutionArray[i]) {
                        result[i] = 'correct';
                        solutionCopy[i] = null;
                    }
                }
                
                for (let i = 0; i < guessArray.length; i++) {
                    if (result[i] === 'correct') continue;
                    
                    const letterIndex = solutionCopy.indexOf(guessArray[i]);
                    if (letterIndex !== -1) {
                        result[i] = 'present';
                        solutionCopy[letterIndex] = null;
                    } else {
                        result[i] = 'absent';
                    }
                }
                
                return result;
            }

            updateKeyStatuses(currentStatuses, guess, evaluation) {
                const newStatuses = { ...currentStatuses };
                
                for (let i = 0; i < guess.length; i++) {
                    const char = guess[i];
                    const status = evaluation[i];
                    
                    if (!newStatuses[char] || status === 'correct') {
                        newStatuses[char] = status;
                    } else if (newStatuses[char] === 'absent' && status === 'present') {
                        newStatuses[char] = status;
                    }
                }
                
                return newStatuses;
            }

            isValidGuess(guess, wordLength = 5) {
                return guess.length === wordLength;
            }

            isWin(guess, solution) {
                return guess === solution;
            }

            calculateGameStats(guesses, isWin) {
                return {
                    totalGuesses: guesses.length,
                    isWin: isWin,
                    efficiency: isWin ? Math.round((6 - guesses.length + 1) / 6 * 100) : 0
                };
            }
        }

        class KeyboardHandler {
            constructor(onKeyPress) {
                this.onKeyPress = onKeyPress;
                this.enabled = true;
            }

            handleKey(key) {
                if (!this.enabled) return;
                
                const upperKey = key.toUpperCase();
                
                if (upperKey === 'ENTER' || upperKey === 'RETURN') {
                    this.onKeyPress('ENTER');
                } else if (upperKey === 'BACKSPACE' || upperKey === 'DELETE') {
                    this.onKeyPress('BACKSPACE');
                } else if (/^[A-ZÜĞIŞÖÇ]$/.test(upperKey)) {
                    this.onKeyPress(upperKey);
                }
            }

            enable() {
                this.enabled = true;
            }

            disable() {
                this.enabled = false;
            }
        }

        // ========== STORAGE HOOK ==========
        class BasicStorage {
            constructor() {
                this.storageKey = 'wordle_games';
                this.loadGames();
            }

            loadGames() {
                try {
                    const stored = localStorage.getItem(this.storageKey);
                    this.games = stored ? JSON.parse(stored) : [];
                } catch (error) {
                    console.error('Error loading games:', error);
                    this.games = [];
                }
            }

            saveGames() {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(this.games));
                } catch (error) {
                    console.error('Error saving games:', error);
                }
            }

            saveGame(gameData) {
                const gameRecord = {
                    id: Date.now().toString(),
                    timestamp: new Date().toISOString(),
                    ...gameData
                };
                
                this.games.unshift(gameRecord);
                this.saveGames();
                return gameRecord;
            }

            addGameResult(gameData) {
                return this.saveGame(gameData);
            }

            getRecentGames(count) {
                return this.games.slice(0, count);
            }

            getAllGames() {
                return this.games;
            }

            getStats() {
                const games = this.games;
                const totalGames = games.length;
                const wins = games.filter(g => g.isWin);
                const totalWins = wins.length;
                
                const guessDistribution = {};
                for (let i = 1; i <= 6; i++) {
                    guessDistribution[i] = wins.filter(g => g.guessCount === i).length;
                }
                
                let currentStreak = 0;
                let bestStreak = 0;
                let tempStreak = 0;
                
                for (let i = 0; i < games.length; i++) {
                    if (games[i].isWin) {
                        tempStreak++;
                        if (i === 0) currentStreak = tempStreak;
                        bestStreak = Math.max(bestStreak, tempStreak);
                    } else {
                        tempStreak = 0;
                        if (i === 0) currentStreak = 0;
                    }
                }
                
                const categories = {};
                const modes = ['ENGLISH', 'TURKEY', 'NATURE'];
                
                modes.forEach(mode => {
                    const modeGames = games.filter(g => g.mode === mode);
                    const modeWins = modeGames.filter(g => g.isWin);
                    
                    categories[mode] = {
                        played: modeGames.length,
                        won: modeWins.length,
                        percentage: modeGames.length > 0 ? 
                            Math.round((modeWins.length / modeGames.length) * 100) : 0
                    };
                });
                
                return {
                    overall: {
                        totalGames,
                        totalWins,
                        winPercentage: totalGames > 0 ? 
                            Math.round((totalWins / totalGames) * 100) : 0,
                        currentStreak,
                        bestStreak,
                        guessDistribution
                    },
                    categories,
                    recentGames: games.slice(0, 20)
                };
            }
        }

        const useEnhancedStorage = () => {
            const [storage] = React.useState(() => {
                if (typeof WordleStorage !== 'undefined') {
                    return new WordleStorage();
                }
                return new BasicStorage();
            });
            
            const [gameHistory, setGameHistory] = React.useState([]);

            React.useEffect(() => {
                if (storage) {
                    const recentGames = storage.getRecentGames ? 
                        storage.getRecentGames(10) : 
                        storage.getAllGames();
                    setGameHistory(recentGames);
                }
            }, [storage]);

            const addGameToHistory = React.useCallback((gameData) => {
                const gameRecord = storage.addGameResult ? 
                    storage.addGameResult(gameData) : 
                    storage.saveGame(gameData);
                    
                const updatedHistory = storage.getRecentGames ? 
                    storage.getRecentGames(10) : 
                    storage.getAllGames();
                    
                setGameHistory(updatedHistory);
                return gameRecord;
            }, [storage]);

            return [gameHistory, addGameToHistory, storage];
        };

        // ========== REACT COMPONENTS ==========
        const MainMenu = ({ navigate }) => (
            <div className="text-center relative">
                <button
                    onClick={() => window.location.href = 'index.html'}
                    className="absolute top-0 left-0 bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors"
                >
                    ← Back to Main Site
                </button>
                <h1 className="font-poppins text-6xl font-bold tracking-tighter mt-16">WORDLE</h1>
                <p className="text-xl font-semibold text-indigo-600 mb-12">Mom Edition</p>
                <button className="menu-button" onClick={() => navigate('MODE_SELECT')}>Play</button>
                <button className="menu-button" onClick={() => navigate('LEADERBOARD')}>Leaderboard</button>
                <button className="menu-button" onClick={() => navigate('STATISTICS')}>Statistics</button>
                <button className="menu-button" onClick={() => alert('Settings coming soon!')}>Settings</button>
            </div>
        );

        const GameModeMenu = ({ onSelectMode }) => (
            <div>
                <h2 className="text-3xl font-bold text-center mb-8">Select Mode</h2>
                <div className="mode-selection-grid">
                    <div className="mode-card" onClick={() => onSelectMode('ENGLISH')}>
                        <div className="mode-image-placeholder">English 🇬🇧</div>
                        <h3>English</h3>
                    </div>
                    <div className="mode-card" onClick={() => onSelectMode('TURKEY')}>
                        <div className="mode-image-placeholder">Turkey 🇹🇷</div>
                        <h3>Türkiye</h3>
                    </div>
                    <div className="mode-card" onClick={() => onSelectMode('NATURE')}>
                        <div className="mode-image-placeholder">Nature 🌿</div>
                        <h3>Doğa</h3>
                    </div>
                </div>
            </div>
        );

        const Row = React.memo(({ guess, solution, isSubmitted }) => {
            const tiles = React.useMemo(() => {
                const result = [];
                for (let i = 0; i < 5; i++) {
                    const char = guess[i];
                    let className = "wordle-tile";
                    if (isSubmitted && char) {
                        if (solution[i] === char) { 
                            className += " correct"; 
                        } else if (solution.includes(char)) { 
                            className += " present"; 
                        } else { 
                            className += " absent"; 
                        }
                    } else if (char) { 
                        className += " filled"; 
                    }
                    result.push(
                        <div key={i} className={className}>
                            <div className="wordle-tile-content">{char}</div>
                        </div>
                    );
                }
                return result;
            }, [guess, solution, isSubmitted]);

            return <>{tiles}</>;
        });

        const WordleGrid = React.memo(({ guesses, currentGuess, solution, isReplay = false }) => {
            const rows = React.useMemo(() => {
                return Array(6).fill(null).map((_, i) => {
                    const guess = guesses[i];
                    const isCurrentRow = !isReplay && (i === guesses.findIndex(g => g === null));
                    return {
                        id: i,
                        guess: isCurrentRow ? currentGuess : guess ?? "",
                        isSubmitted: guess != null
                    };
                });
            }, [guesses, currentGuess, isReplay]);

            return (
                <div className="wordle-grid">
                    {rows.map(({ id, guess, isSubmitted }) => (
                        <Row key={id} guess={guess} solution={solution} isSubmitted={isSubmitted} />
                    ))}
                </div>
            );
        });

        const Keyboard = React.memo(({ onKeyPress, keyStatuses }) => {
            const rows = GAME_CONFIG.KEYBOARD_LAYOUTS.TURKISH;

            return (
                <div className="keyboard-container">
                    {rows.map((row, i) => (
                        <div key={i} className="keyboard-row">
                            {row.map(key => {
                                const status = keyStatuses[key];
                                const keyClassName = `key ${status ? status : ''} ${(key === "ENTER" || key === "BACKSPACE") ? 'special' : ''}`;
                                const displayKey = SPECIAL_KEYS[key] || key;
                                
                                return (
                                    <button
                                        key={key}
                                        className={keyClassName}
                                        onClick={() => onKeyPress(key)}
                                    >
                                        {displayKey}
                                    </button>
                                );
                            })}
                        </div>
                    ))}
                </div>
            );
        });

        const EndOfRoundMenu = ({ status, solution, onNextWord, onBackToMenu }) => {
            const [isAnswerVisible, setIsAnswerVisible] = React.useState(false);
            const isWin = status === 'won';
            
            return (
                <div className="end-round-modal">
                    <h2 className={`end-round-title ${isWin ? 'win' : 'loss'}`}>
                        {isWin ? "Correct!" : "WRONG!"}
                    </h2>
                    {isAnswerVisible && (
                        <p className="text-lg font-semibold mb-4">
                            The word was: <span className="font-bold text-indigo-600">{solution}</span>
                        </p>
                    )}
                    <div className="flex flex-col gap-4 w-3/4">
                        {!isWin && !isAnswerVisible && (
                            <button 
                                className="menu-button bg-yellow-500 hover:bg-yellow-600" 
                                onClick={() => setIsAnswerVisible(true)}
                            >
                                Show Answer
                            </button>
                        )}
                        <button 
                            className="menu-button bg-indigo-500 hover:bg-indigo-600" 
                            onClick={onNextWord}
                        >
                            Next Word
                        </button>
                        <button 
                            className="menu-button secondary" 
                            onClick={onBackToMenu}
                        >
                            Back to Menu
                        </button>
                    </div>
                </div>
            );
        };

        const WordleGame = ({ solution, onGameOver, onNextWord, onBackToMenu }) => {
            const [guesses, setGuesses] = React.useState(Array(6).fill(null));
            const [currentGuess, setCurrentGuess] = React.useState("");
            const [roundStatus, setRoundStatus] = React.useState('playing');
            const [keyStatuses, setKeyStatuses] = React.useState({});
            const [gameLogic] = React.useState(() => new WordleGameLogic());
            const [keyboardHandler, setKeyboardHandler] = React.useState(null);

            React.useEffect(() => {
                const handler = new KeyboardHandler((key) => handleKeyPress(key));
                setKeyboardHandler(handler);
                
                const handleKeyDown = (e) => handler.handleKey(e.key);
                window.addEventListener('keydown', handleKeyDown);
                
                return () => {
                    window.removeEventListener('keydown', handleKeyDown);
                };
            }, [currentGuess, roundStatus, guesses, solution, keyStatuses]);

            const handleEndRound = (isWin) => {
                if (keyboardHandler) {
                    keyboardHandler.disable();
                }
                
                const finalGuesses = [...guesses];
                const currentGuessIndex = guesses.findIndex(g => g === null);
                if (currentGuessIndex !== -1) {
                    finalGuesses[currentGuessIndex] = currentGuess;
                }
                
                const stats = gameLogic.calculateGameStats(
                    finalGuesses.filter(Boolean), 
                    isWin
                );
                
                onGameOver({
                    solution,
                    guesses: finalGuesses.filter(Boolean),
                    isWin,
                    stats
                });
                
                setRoundStatus(isWin ? 'won' : 'lost');
            };

            const handleKeyPress = React.useCallback((key) => {
                if (roundStatus !== 'playing') return;

                if (key === "ENTER") {
                    if (!gameLogic.isValidGuess(currentGuess, GAME_CONFIG.WORD_LENGTH)) {
                        return;
                    }

                    const evaluation = gameLogic.evaluateGuess(currentGuess, solution);
                    const newKeyStatuses = gameLogic.updateKeyStatuses(
                        keyStatuses, 
                        currentGuess, 
                        evaluation
                    );
                    setKeyStatuses(newKeyStatuses);

                    const newGuesses = [...guesses];
                    const currentGuessIndex = guesses.findIndex(g => g === null);
                    newGuesses[currentGuessIndex] = currentGuess;
                    setGuesses(newGuesses);
                    
                    if (gameLogic.isWin(currentGuess, solution)) {
                        handleEndRound(true);
                    } else if (currentGuessIndex === GAME_CONFIG.MAX_GUESSES - 1) {
                        handleEndRound(false);
                    } else {
                        setCurrentGuess("");
                    }
                } else if (key === "BACKSPACE") {
                    setCurrentGuess(prev => prev.slice(0, -1));
                } else if (currentGuess.length < GAME_CONFIG.WORD_LENGTH && /^[A-ZÜĞIŞÖÇ]$/.test(key)) {
                    setCurrentGuess(prev => prev + key);
                }
            }, [currentGuess, roundStatus, guesses, solution, keyStatuses, gameLogic]);

            const handleNextWordClick = () => {
                setGuesses(Array(6).fill(null));
                setCurrentGuess("");
                setRoundStatus('playing');
                setKeyStatuses({});
                if (keyboardHandler) {
                    keyboardHandler.enable();
                }
                onNextWord();
            };

            return (
                <div className="wordle-container">
                    <div className="mb-4 text-center">
                        <span className="text-sm text-gray-600">
                            Guess {guesses.filter(g => g !== null).length + 1} of {GAME_CONFIG.MAX_GUESSES}
                        </span>
                    </div>
                    
                    <WordleGrid 
                        guesses={guesses} 
                        currentGuess={currentGuess} 
                        solution={solution} 
                    />
                    
                    <Keyboard 
                        onKeyPress={handleKeyPress} 
                        keyStatuses={keyStatuses} 
                    />
                    
                    {roundStatus !== 'playing' && (
                        <EndOfRoundMenu
                            status={roundStatus}
                            solution={solution}
                            onNextWord={handleNextWordClick}
                            onBackToMenu={onBackToMenu}
                        />
                    )}
                </div>
            );
        };

        const Leaderboard = ({ history, navigate }) => {
            const [selectedGame, setSelectedGame] = React.useState(history.length > 0 ? history[0] : null);

            return (
                <div>
                    <h2 className="text-3xl font-bold text-center mb-8">Previous Games</h2>
                    <div className="leaderboard-container">
                        <div className="leaderboard-list">
                            {history.length === 0 ? (
                                <p className="text-gray-500 text-center">No games played yet.</p>
                            ) : (
                                history.map((game, index) => (
                                    <div
                                        key={game.id || index}
                                        className={`leaderboard-item ${game.isWin ? 'win' : 'loss'} ${selectedGame === game ? 'selected' : ''}`}
                                        onClick={() => setSelectedGame(game)}
                                    >
                                        <span>{game.solution}</span>
                                        <span className="text-xs text-gray-500 ml-2">
                                            {new Date(game.timestamp).toLocaleDateString()}
                                        </span>
                                    </div>
                                ))
                            )}
                        </div>
                        <div className="leaderboard-preview">
                            {selectedGame ? (
                                <WordleGrid 
                                    guesses={selectedGame.guesses} 
                                    solution={selectedGame.solution} 
                                    isReplay={true} 
                                />
                            ) : (
                                <div className="flex items-center justify-center h-full text-gray-400">
                                    Select a game to view
                                </div>
                            )}
                        </div>
                    </div>
                    <button 
                        className="mt-8 w-full text-center py-2 text-indigo-600 font-semibold hover:text-indigo-800" 
                        onClick={() => navigate('MENU')}
                    >
                        ← Back to Menu
                    </button>
                </div>
            );
        };

        const GuessDistribution = ({ distribution, totalWins }) => {
            const maxCount = Math.max(...Object.values(distribution));

            return (
                <div className="space-y-2">
                    {[1, 2, 3, 4, 5, 6].map(guessNum => {
                        const count = distribution[guessNum] || 0;
                        const percentage = totalWins > 0 ? (count / totalWins) * 100 : 0;
                        const width = maxCount > 0 ? (count / maxCount) * 100 : 0;

                        return (
                            <div key={guessNum} className="flex items-center space-x-3">
                                <span className="w-4 text-sm font-medium">{guessNum}</span>
                                <div className="flex-1 bg-gray-200 rounded-full h-6 relative">
                                    <div
                                        className="bg-gradient-to-r from-green-500 to-green-400 h-6 rounded-full flex items-center justify-end pr-2 transition-all duration-500"
                                        style={{ width: `${Math.max(width, count > 0 ? 15 : 0)}%` }}
                                    >
                                        {count > 0 && (
                                            <span className="text-white text-xs font-medium">{count}</span>
                                        )}
                                    </div>
                                </div>
                                <span className="w-12 text-sm text-gray-600">{percentage.toFixed(0)}%</span>
                            </div>
                        );
                    })}
                </div>
            );
        };

        const CategoryPerformance = ({ categories }) => {
            return (
                <div className="space-y-3">
                    {Object.entries(categories).map(([category, categoryStats]) => {
                        const percentage = categoryStats.played > 0 ? categoryStats.percentage : 0;
                        const performanceColor = percentage >= 70 ? 'bg-green-100 text-green-800' :
                            percentage >= 50 ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800';

                        return (
                            <div key={category} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div className="flex items-center space-x-3">
                                    <span className="font-medium">{CATEGORY_NAMES[category]}</span>
                                </div>
                                <div className="flex items-center space-x-4 text-sm">
                                    <span className="text-gray-600">{categoryStats.played} played</span>
                                    <span className="text-gray-600">{categoryStats.won} won</span>
                                    <span className={`font-medium px-2 py-1 rounded ${performanceColor}`}>
                                        {percentage}%
                                    </span>
                                </div>
                            </div>
                        );
                    })}
                </div>
            );
        };

        const RecentGames = ({ games }) => {
            if (games.length === 0) {
                return <p className="text-gray-500">No recent games</p>;
            }

            return (
                <div className="grid grid-cols-5 gap-2">
                    {games.slice(0, 20).map((game, index) => (
                        <div
                            key={game.id || index}
                            className={`aspect-square rounded border-2 flex flex-col items-center justify-center text-xs font-bold cursor-pointer hover:scale-110 transition-transform ${
                                game.isWin
                                    ? 'border-green-500 bg-green-100 text-green-800'
                                    : 'border-red-500 bg-red-100 text-red-800'
                            }`}
                            title={`${game.solution} - ${game.isWin ? 'Won' : 'Lost'} - ${new Date(game.timestamp).toLocaleDateString()}`}
                        >
                            <div>{game.isWin ? (game.guessCount || '✓') : '✗'}</div>
                            <div className="text-[8px] mt-1">{game.solution ? game.solution.slice(0, 3) : '???'}</div>
                        </div>
                    ))}
                </div>
            );
        };

        const Statistics = ({ storage, navigate }) => {
            const [stats, setStats] = React.useState(null);

            React.useEffect(() => {
                if (storage) {
                    setStats(storage.getStats());
                }
            }, [storage]);

            if (!stats) {
                return (
                    <div className="text-center">
                        <div className="spinner">Loading statistics...</div>
                    </div>
                );
            }

            const { overall, categories } = stats;

            const getPerformanceLevel = (percentage) => {
                if (percentage >= 80) return { level: 'Expert', color: 'text-purple-600', bg: 'bg-purple-100' };
                if (percentage >= 70) return { level: 'Great', color: 'text-green-600', bg: 'bg-green-100' };
                if (percentage >= 50) return { level: 'Good', color: 'text-yellow-600', bg: 'bg-yellow-100' };
                return { level: 'Learning', color: 'text-red-600', bg: 'bg-red-100' };
            };

            const performance = getPerformanceLevel(overall.winPercentage);

            return (
                <div className="space-y-6">
                    <div className="text-center">
                        <h2 className="text-3xl font-bold mb-2">Mom's Wordle Statistics</h2>
                        <div className={`inline-block px-4 py-1 rounded-full ${performance.bg}`}>
                            <span className={`font-semibold ${performance.color}`}>
                                {performance.level} Player
                            </span>
                        </div>
                    </div>

                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="stat-label">Games Played</p>
                                    <p className="stat-value text-blue-600">{overall.totalGames}</p>
                                </div>
                                <span className="text-3xl">🎮</span>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="stat-label">Win Rate</p>
                                    <p className={`stat-value ${performance.color}`}>
                                        {overall.winPercentage}%
                                    </p>
                                </div>
                                <span className="text-3xl">🏆</span>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="stat-label">Current Streak</p>
                                    <p className="stat-value text-orange-600">{overall.currentStreak}</p>
                                </div>
                                <span className="text-3xl">🔥</span>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="flex items-center justify-between">
                                <div>
                                    <p className="stat-label">Best Streak</p>
                                    <p className="stat-value text-purple-600">{overall.bestStreak}</p>
                                </div>
                                <span className="text-3xl">⭐</span>
                            </div>
                        </div>
                    </div>

                    {overall.totalWins > 0 && (
                        <div className="bg-white p-6 rounded-lg shadow border">
                            <h3 className="text-xl font-bold mb-4">Guess Distribution</h3>
                            <GuessDistribution distribution={overall.guessDistribution} totalWins={overall.totalWins} />
                        </div>
                    )}

                    <div className="bg-white p-6 rounded-lg shadow border">
                        <h3 className="text-xl font-bold mb-4">Category Performance</h3>
                        <CategoryPerformance categories={categories} />
                    </div>

                    <div className="bg-white p-6 rounded-lg shadow border">
                        <h3 className="text-xl font-bold mb-4">Recent Games</h3>
                        <RecentGames games={stats.recentGames || []} />
                    </div>

                    <button
                        className="w-full text-center py-2 text-indigo-600 font-semibold hover:text-indigo-800"
                        onClick={() => navigate('MENU')}
                    >
                        ← Back to Menu
                    </button>
                </div>
            );
        };

        // ========== MAIN APP COMPONENT ==========
        const App = () => {
            const [page, setPage] = React.useState('MENU');
            const [gameHistory, addGameToHistory, storage] = useEnhancedStorage();
            const [gameConfig, setGameConfig] = React.useState({ mode: null, solution: null });
            const [gameLogic] = React.useState(() => new WordleGameLogic());

            const handleSelectMode = (mode) => {
                const solution = gameLogic.selectRandomWord(mode);
                setGameConfig({ mode, solution });
                setPage('GAME');
            };

            const handleGameOver = (gameResult) => {
                const enhancedGameData = {
                    solution: gameConfig.solution,
                    guesses: gameResult.guesses,
                    isWin: gameResult.isWin,
                    mode: gameConfig.mode,
                    guessCount: gameResult.isWin ? gameResult.guesses.length : null,
                    timestamp: new Date().toISOString(),
                    stats: gameResult.stats || {}
                };
                
                addGameToHistory(enhancedGameData);
            };

            const handleNextWord = () => {
                const { mode, solution: currentSolution } = gameConfig;
                if (mode) {
                    const newSolution = gameLogic.selectRandomWord(mode, currentSolution);
                    setGameConfig({ mode, solution: newSolution });
                    setPage('GAME_REFRESH');
                    setTimeout(() => setPage('GAME'), 0);
                }
            };

            const navigate = React.useCallback((newPage) => {
                setPage(newPage);
            }, []);

            const renderPage = () => {
                switch (page) {
                    case 'MENU':
                        return <MainMenu navigate={navigate} />;
                        
                    case 'MODE_SELECT':
                        return <GameModeMenu onSelectMode={handleSelectMode} />;
                        
                    case 'GAME':
                    case 'GAME_REFRESH':
                        return gameConfig.solution ? (
                            <WordleGame
                                key={`${gameConfig.solution}-${Date.now()}`}
                                solution={gameConfig.solution}
                                onGameOver={handleGameOver}
                                onNextWord={handleNextWord}
                                onBackToMenu={() => navigate('MENU')}
                            />
                        ) : (
                            <div>Loading game...</div>
                        );
                        
                    case 'LEADERBOARD':
                        return <Leaderboard history={gameHistory} navigate={navigate} />;
                        
                    case 'STATISTICS':
                        return <Statistics storage={storage} navigate={navigate} />;
                        
                    default:
                        return <MainMenu navigate={navigate} />;
                }
            };

            return (
                <div className="app-container">
                    {page !== 'MENU' && page !== 'GAME' && page !== 'GAME_REFRESH' && (
                        <div className="mb-4">
                            <button
                                onClick={() => navigate('MENU')}
                                className="text-sm text-gray-600 hover:text-gray-900"
                            >
                                ← Main Menu
                            </button>
                        </div>
                    )}
                    
                    {renderPage()}
                    
                    <div className="mt-8 text-center text-xs text-gray-400">
                        Wordle Mom Edition v1.0
                    </div>
                </div>
            );
        };

        // ========== INITIALIZE APP ==========
        const initializeApp = () => {
            const container = document.getElementById('root');
            if (container) {
                const root = ReactDOM.createRoot(container);
                root.render(<App />);
                console.log('Wordle app initialized successfully!');
            } else {
                console.error('Root element not found!');
            }
        };

        // Wait for page to load then initialize
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>